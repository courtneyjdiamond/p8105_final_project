---
title: "AirQuality Dataset Exploratoration"
output: html_document
---
```{r setup, include=FALSE}
library(tidyverse)
```

To explore the impact of weather trends on Citibike ridership in New York City, we used [Air Quality](https://data.cityofnewyork.us/Environment/Air-Quality/c3uy-2p5r) dataset from the [NYC Open Data](https://opendata.cityofnewyork.us/), provided by the Department of Hygiene and Mental Health. 

This dataset includes air quality indexes measured across NYC boroughs. Our analysis aims to uncover relationships between air quality variations and Citibike ridership, offering insights into how environmental factors influence urban mobility patterns.

## Air Quality Exploratory analyses
```{r}
#import data
air <- read_csv("air_quality/Air_Quality_20231126.csv") 

#Air Quality tidy
air_quality_df =air |>
  janitor::clean_names() |>
  mutate(
    start_date = mdy(start_date),
    year = year(start_date)
  ) |>
  filter(year == "2019")
```

Average Air Quality Index Across Time Periods
```{r}
air_quality_df |>
  group_by(time_period) |>
  summarise(avg_air_quality = mean(data_value)) |>
  ggplot(aes(x = reorder(time_period, avg_air_quality), y = avg_air_quality)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Average Air Quality Index Across Time Periods",
       x = "Time Period",
       y = "Average Air Quality Index") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
```

Air Quality Comparison
```{r}
air_quality_df |>
  ggplot(aes(x = reorder(geo_place_name, data_value), y = data_value)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  facet_wrap(~ name + measure_info, scales = "free_y", ncol = 3) +
  labs(title = "Air Quality Comparison",
       x = "Geographical Place",
       y = "Data Value") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5))
```


```{r}
outliers = air_quality_df |>
  group_by(geo_place_name) |>
  filter(data_value > quantile(data_value, 0.75) + 1.5 * IQR(data_value) | data_value < quantile(data_value, 0.25) - 1.5 * IQR(data_value))

outliers |>
  ggplot(aes(x = reorder(geo_place_name, data_value), y = data_value)) +
  geom_point(aes(color = factor(measure_info)), size = 3) +
  geom_line(aes(group = interaction(name, measure_info), color = factor(measure_info)),
            stat = "summary", fun = "mean", size = 1, linetype = "dashed") +
  facet_wrap(~ name + measure_info, scales = "free_y", ncol = 3) +
  labs(title = "Outliers of the Air Quality",
       x = "Geographical Place",
       y = "Data Value",
       color = "Measure Info") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5))
```

