---
title: "<span style='color: blue;'>Analysis</span>"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: yeti
    code_folding: hide
css: styles.css
---

<style>
  h1 {
     font-weight: bold;
  }
</style>

***

In order to explore New Yorker's use of the Citibike program, we examined data on rides, users demographics, neighborhood disparities, and health implications. By looking at these facets individually, and then in comparison through linear models, we sought to unravel the connections between bikes and health. 

This page includes a few summary tables of the Citibike data, links to view deeper explorations of the air quality index, social deprivation index, and weight data, and links to our model page with full model charts and graphs. 

 &nbsp;

# <span style='color: blue;'>Citibike Exploration</span>

 &nbsp;
 
## <span style='color: blue;'>Geographic utilization</span> 

 &nbsp;

```{r setup, include=FALSE}
library(tidyverse)
library(pdftools)
library(magrittr)
library(here)

knitr::opts_chunk$set(message = FALSE,
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

library(ggridges)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

<<<<<<< HEAD
```{r, eval = FALSE}
citibike_zip_neighborhoods <- read_csv("citibike/citibike_zip_neighborhood.csv")
=======
```{r, eval = FALSE}
citibike_df <- read.csv("./data/geocoding/citibike_zip_neighborhoods.csv")
>>>>>>> refs/remotes/origin/main
```

```{r}
citibike_df <- read.csv("/Users/Haley/Desktop/citibike_df.csv")
```

This table shows the number of stations per neighborhood used in September.

```{r table of stations per neighborhoods}
station <- citibike_df %>%
  filter(!is.na(end_station_name) | !is.na(start_station_name)) %>%
  select(
    end_station_name, end_uhf34_neighborhood, start_station_name, start_uhf34_neighborhood,
    start_borough, end_borough
  ) %>%
  distinct(
    Neighborhood = coalesce(end_uhf34_neighborhood, start_uhf34_neighborhood),
    Station_Name = coalesce(end_station_name, start_station_name),
    Borough = coalesce(end_borough, start_borough)
  )

  station %>%
 group_by(Borough, Neighborhood) %>%
  summarize(Number_of_Stations = n()) %>%
  arrange(Borough)|>
     knitr:: kable()
```


This graph shows that most start and end rides occurred in Manhattan in September 2019. 


```{r graph of station stop/start per borough}

# Assuming citibike_df is your dataframe
combined_df <- bind_rows(
  citibike_df %>%
    group_by(borough = start_borough) %>%
    summarise(n_rides = n()) %>%
    top_n(10, wt = n_rides) %>%
    mutate(station_type = "Start Station"),
  citibike_df %>%
    group_by(borough = end_borough) %>%
    summarise(n_rides = n()) %>%
    top_n(10, wt = n_rides) %>%
    mutate(station_type = "End Station")
)

# Create faceted plot
ggplot(combined_df, aes(x = reorder(borough, n_rides), y = n_rides)) +
  geom_bar(stat = "identity") +
  labs(x = "Borough", y = "Number of Rides") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~station_type, scales = "free_x")
```

Here are the most popular starting and stopping stations in September 2019 - also in Manhattan.

```{r start stations}

# Assuming citibike_df is your dataframe
combined_df <- bind_rows(
  citibike_df %>%
    group_by(station = start_station_name) %>%
    summarise(n_rides = n()) %>%
    top_n(10, wt = n_rides) %>%
    mutate(station_type = "Start Station"),
  citibike_df %>%
    group_by(station = end_station_name) %>%
    summarise(n_rides = n()) %>%
    top_n(10, wt = n_rides) %>%
    mutate(station_type = "End Station")
)

# Create faceted plot
ggplot(combined_df, aes(x = reorder(station, n_rides), y = n_rides)) +
  geom_bar(stat = "identity")  +
  labs(x = "Station", y = "Number of Rides") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~station_type, scales = "free_x")

```

Add in plot for rides per day of the week here:

## <span style='color: blue;'>User Demographics</span> 

Here is a graph of user type distribution: Subscribers take more rides!

```{r rider per subscriber}
# Count the number of rides for each user type
citibike_df %>%
  group_by(user_type) %>%
  summarise(n_rides = n()) |>
ggplot(aes(x = user_type, y = n_rides, fill = user_type)) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = scales::comma_format()) +
  labs(x = "User Type", y = "Number of Rides", title = "User Type Distribution")
```

Here is a graph of number of rides per gender: Males take the most rides!

```{r rides per gender}

citibike_df %>%
  group_by(gender) %>%
  summarise(n_rides = n()) |>ggplot(aes(x = gender, y = n_rides, fill = gender)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("Male" = "blue", "Female" = "red", "Unknown" = "yellow")) +
  scale_y_continuous(labels = scales::comma_format()) +
  labs(x = "Gender", y = "Number of Rides", title = "Gender Distribution")
```

This graph shows the distribution of ages: 30 year olds and 50 year olds use citibike the most!

```{r age distribution}
ggplot(citibike_df, aes(x = age)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
   scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) +
  scale_y_continuous(labels = scales::comma_format()) +
  labs(x = "Age", y = "Number of Rides", title = "Age Distribution")
```

# <span style='color: blue;'>Exploring Subsets</span>


[Air Quality index](exploratory/AirQual_exploratory.html)

[Social deprivation Index](exploratory/SDI_Exploratory.html)

[Overweight Trends](exploratory/Weight_exploratory.html) 

And we made an interactive [dashboard](https://courtneyjdiamond.shinyapps.io/ExploratoryDashboard/) to visualize some of these exploratory analyses all together!

 &nbsp;
 
 ***
 
# <span style='color: blue;'>Modelling</span>

We sought to develop linear models that would characterize the number of rides per station as a surrogate for utilization of citibikes. Predictors included Air quality measures, social deprivation index, and percentage of overweight individuals in a neighborhood. 

We then built on these models and looked at the outcomes of these metrics, based on the other metrics and citibike utilization. 

[Models](modeling/Modeling.html)

