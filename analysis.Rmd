---
title: "<span style='color: blue;'>Analysis</span>"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: yeti
    code_folding: hide
css: styles.css
---

<style>
  h1 {
     font-weight: bold;
  }
</style>

***

In order to explore New Yorker's use of the Citibike program, we examined data on rides, users demographics, neighborhood disparities, and health implications. By looking at these facets individually, and then in comparison through linear models, we sought to unravel the connections between bikes and health. 

This page includes a few summary tables of the Citibike data, links to view deeper explorations of the air quality index, social deprivation index, and weight data, and links to our model page with full model charts and graphs. 

 &nbsp;

# <span style='color: blue;'>Citibike Exploration</span>

 &nbsp;
 
## <span style='color: blue;'>Geographic utilization</span> 

 &nbsp;

```{r setup, include=FALSE}
library(tidyverse)

knitr::opts_chunk$set(message = FALSE,
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

library(ggridges)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r, eval = FALSE}
citibike_zip_neighborhoods <- read.csv("./data/geocoding/citibike_zip_neighborhoods.csv")
```

```{r, eval = FALSE}
citibike_zip_neighborhoods <- read.csv("/Users/Haley/Desktop/citibike_zip_neighborhoods.csv")
```

Here is a table of the number of stations per neighborhood.

```{r table of stations per neighborhoods, eval = FALSE}
station = citibike_zip_neighborhoods %>%
  filter(!is.na(end_station_name) | !is.na(start_station_name)) %>%
  select(end_station_name, end_uhf34_neighborhood, start_station_name, start_uhf34_neighborhood) %>%
  distinct(Neighborhood = coalesce(end_uhf34_neighborhood, start_uhf34_neighborhood),
           Station_Name = coalesce(end_station_name, start_station_name))

  station %>%
  group_by(Neighborhood) %>%
  summarize(Number_of_Stations = n())|>
  arrange(desc(Number_of_Stations))|>
     knitr:: kable()
```

Here is a table of the number of rides per start neighborhood.

```{r table of start neighborhoods, eval = FALSE}
citibike_zip_neighborhoods |>
group_by(start_uhf34_neighborhood) |>
  rename("Start_Neighborhood" = start_uhf34_neighborhood) |>
  summarize(Number_Rides = n()) |>
  arrange(desc(Number_Rides)) |>
  knitr:: kable()
```

Here is a table of the number of rides per end neighborhood.

```{r table of end neighborhoods, eval= FALSE}
citibike_zip_neighborhoods |>
group_by(end_uhf34_neighborhood) |>
  summarize(Number_Rides = n()) |>
  rename("End_Neighborhood" = end_uhf34_neighborhood) |>
   arrange(desc(Number_Rides)) |>
  knitr:: kable()
```

Here are the most popular start stations.

```{r, eval = FALSE}
# Count the number of rides for each start station
popular_stations <- citibike_zip_neighborhoods %>%
  group_by(start_station_name) %>%
  summarise(n_rides = n()) %>%
  top_n(10, wt = n_rides)  # Select the top 10 most popular stations

# Plot the most popular landmark stations
ggplot(popular_stations, aes(x = reorder(start_station_name, n_rides), y = n_rides)) +
  geom_bar(stat = "identity") +
  labs(x = "Start Station", y = "Number of Rides", title = "Top 10 Most Popular Start Stations") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Here is a graph of the most popular end stations

```{r, eval = FALSE}
# Count the number of rides for each start station
popular_stations <- citibike_zip_neighborhoods %>%
  group_by(end_station_name) %>%
  summarise(n_rides = n()) %>%
  top_n(10, wt = n_rides)  # Select the top 10 most popular stations

# Plot the most popular landmark stations
ggplot(popular_stations, aes(x = reorder(end_station_name, n_rides), y = n_rides)) +
  geom_bar(stat = "identity") +
  labs(x = "End Station", y = "Number of Rides", title = "Top 10 Most Popular End Stations") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Here is a graph of the number of rides per neighborhood per month

```{r neighborhood_month, eval = FALSE}
citibike_zip_neighborhoods |>
  select(start_time, start_uhf34_neighborhood) |>
  mutate(month = as.factor(month(start_time))) |>
  group_by(start_uhf34_neighborhood, month) |>
  summarize(n_rides = n()) |>
  ggplot(aes(x = month, y = n_rides, color = start_uhf34_neighborhood, group = start_uhf34_neighborhood)) +
  geom_point() +
  geom_line() +
  scale_y_continuous(labels = scales::comma_format()) +
  labs(x = "Month", y = "Number of Rides")
```


```{r , eval = FALSE}

rides_by_month <- citibike_zip_neighborhoods %>%
  mutate(month = format(start_time, "%Y-%m")) %>%
  group_by(month) %>%
  summarise(n_rides = n())

# Plot the number of rides by month
ggplot(rides_by_month, aes(x = month, y = n_rides)) +
  geom_line() +
  geom_point() +
  labs(x = "Month", y = "Number of Rides", title = "Number of Rides by Month") +
  scale_y_continuous(labels = scales::comma_format()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

[Citibike](exploratory/Citibike_exploratory.html)

## Exploring Subsets

[Air Quality index](exploratory/AirQual_exploratory.html)

[Social deprivation Index](exploratory/SDI_Exploratory.html)

[Overweight Trends](exploratory/Weight_exploratory.html) 

And we made an interactive [dashboard](Dashboard_Shiny.html) to visualize some of these exploratory analyses all together!

 &nbsp;
 
 ***
 
 # <span style='color: blue;'>Modeling Outcomes</span>


We sought to develop linear models that would characterize the number of rides per station as a surrogate for utilization of citibikes. Predictors included Air quality measures, social deprivation index, and percentage of overweight individuals in a neighborhood. 

We then built on these models and looked at the outcomes of these metrics, based on the other metrics and citibike utilization. 

[Models](modeling/Modeling.html)

