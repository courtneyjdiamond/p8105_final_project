<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data Sources and Overview</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="data_source.html">Data Sources</a>
</li>
<li>
  <a href="analysis.html">Analysis</a>
</li>
<li>
  <a href="project_report.html">Project Report</a>
</li>
<li>
  <a href="about_us.html">About Us</a>
</li>
<li>
  <a href="mailto:&lt;jl5934@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/courtneyjdiamond/p8105_final_project">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://citibikenyc.com/">
    <span class="fa fa-solid fa-bicycle"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><span style="color: blue;">Data Sources and
Overview</span></h1>

</div>


<style>
  h1 {
     font-weight: bold;
  }
</style>
<p> </p>
<hr />
<div id="data-sources" class="section level2">
<h2><span style="color: blue;">Data Sources</span></h2>
<p> </p>
<p><a
href="https://s3.amazonaws.com/tripdata/index.html"><strong>CitiBike
Data</strong></a>: These datasets contain monthly logs of trip,
including ride ID, the user’s status (subscriber or casual user), trip
start/end longitude/latitude coordinates, and the trip start/stop times
and duration.</p>
<p><a
href="https://www.graham-center.org/maps-data-tools/social-deprivation-index.html"><strong>Social
Deprivation Index</strong></a>: The social deprivation index (SDI) is an
effort to generate a scoring system of socioeconomic factors using US
census data from the American Community Survey. The final SDI is a
composite measure of percent living in poverty, percent with less than
12 years of education, percent single-parent households, the percentage
living in rented housing units, the percentage living in the overcrowded
housing unit, percent of households without a car, and percentage
nonemployed adults under 65 years of age. For more details please see
the webpage link.</p>
<p><a
href="https://a816-dohbesp.nyc.gov/IndicatorPublic/Subtopic.aspx?theme_code=2,3&amp;subtopic_id=113"><strong>Overweight
Data</strong></a>: This dataset contains publicly available data from
NYC regarding the percent of people who are overweight per area.</p>
<p><a
href="https://data.cityofnewyork.us/Environment/Air-Quality/c3uy-2p5r"><strong>Air
Quality Index Data</strong></a>: These data originated from NYC Open
Data, contributed by the Department of Hygiene and Mental Health and
include air quality indexes measured across boroughs in NYC.</p>
<p> </p>
<hr />
</div>
<div id="individual-data-imports-and-cleaning" class="section level2">
<h2><span style="color: blue;">Individual Data Imports and
Cleaning</span></h2>
<p> </p>
<div id="citibike" class="section level3">
<h3><em>Citibike</em></h3>
<p> </p>
<div id="data-import" class="section level5">
<h5>Data Import</h5>
<p>The citibike data was a collection of csv files that we downloaded
and merged. We were specifically interested in 2019 as this was when SDI
scores were available. We downloaded the data files from December 2018
through January 2020.</p>
<pre class="r"><code>citibike = 
  tibble(
    files = list.files(&quot;./citibike&quot;),
    path = str_c(&quot;./citibike/&quot;, files)
  ) |&gt;
  mutate(data = map(path, ~read_csv(.x, col_types = cols(
    &#39;end station id&#39; = col_double(),
    &#39;start station id&#39; = col_double()
  )))) |&gt;
  unnest(cols = c(data))</code></pre>
<pre class="r"><code>citibike |&gt;
  head() |&gt;
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="8%" />
<col width="11%" />
<col width="3%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="8%" />
<col width="6%" />
<col width="7%" />
<col width="4%" />
<col width="8%" />
<col width="6%" />
<col width="6%" />
<col width="2%" />
<col width="3%" />
<col width="3%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">files</th>
<th align="left">path</th>
<th align="right">tripduration</th>
<th align="left">starttime</th>
<th align="left">stoptime</th>
<th align="right">start station id</th>
<th align="left">start station name</th>
<th align="right">start station latitude</th>
<th align="right">start station longitude</th>
<th align="right">end station id</th>
<th align="left">end station name</th>
<th align="right">end station latitude</th>
<th align="right">end station longitude</th>
<th align="right">bikeid</th>
<th align="left">usertype</th>
<th align="right">birth year</th>
<th align="right">gender</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">689</td>
<td align="left">2018-12-01 00:00:04</td>
<td align="left">2018-12-01 00:11:33</td>
<td align="right">3359</td>
<td align="left">E 68 St &amp; Madison Ave</td>
<td align="right">40.76916</td>
<td align="right">-73.96703</td>
<td align="right">164</td>
<td align="left">E 47 St &amp; 2 Ave</td>
<td align="right">40.75323</td>
<td align="right">-73.97033</td>
<td align="right">35033</td>
<td align="left">Subscriber</td>
<td align="right">1989</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">204</td>
<td align="left">2018-12-01 00:00:05</td>
<td align="left">2018-12-01 00:03:30</td>
<td align="right">3504</td>
<td align="left">E 123 St &amp; Lexington Ave</td>
<td align="right">40.80293</td>
<td align="right">-73.93790</td>
<td align="right">3490</td>
<td align="left">E 116 St &amp; 2 Ave</td>
<td align="right">40.79688</td>
<td align="right">-73.93726</td>
<td align="right">20501</td>
<td align="left">Subscriber</td>
<td align="right">1966</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">316</td>
<td align="left">2018-12-01 00:00:10</td>
<td align="left">2018-12-01 00:05:27</td>
<td align="right">270</td>
<td align="left">Adelphi St &amp; Myrtle Ave</td>
<td align="right">40.69308</td>
<td align="right">-73.97179</td>
<td align="right">243</td>
<td align="left">Fulton St &amp; Rockwell Pl</td>
<td align="right">40.68823</td>
<td align="right">-73.97938</td>
<td align="right">18386</td>
<td align="left">Subscriber</td>
<td align="right">1984</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">726</td>
<td align="left">2018-12-01 00:00:21</td>
<td align="left">2018-12-01 00:12:28</td>
<td align="right">495</td>
<td align="left">W 47 St &amp; 10 Ave</td>
<td align="right">40.76270</td>
<td align="right">-73.99301</td>
<td align="right">3660</td>
<td align="left">W 16 St &amp; 8 Ave</td>
<td align="right">40.74102</td>
<td align="right">-74.00138</td>
<td align="right">27616</td>
<td align="left">Subscriber</td>
<td align="right">1983</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">397</td>
<td align="left">2018-12-01 00:00:29</td>
<td align="left">2018-12-01 00:07:07</td>
<td align="right">473</td>
<td align="left">Rivington St &amp; Chrystie St</td>
<td align="right">40.72110</td>
<td align="right">-73.99193</td>
<td align="right">3467</td>
<td align="left">W Broadway &amp; Spring Street</td>
<td align="right">40.72495</td>
<td align="right">-74.00166</td>
<td align="right">35096</td>
<td align="left">Subscriber</td>
<td align="right">1976</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">299</td>
<td align="left">2018-12-01 00:00:30</td>
<td align="left">2018-12-01 00:05:30</td>
<td align="right">237</td>
<td align="left">E 11 St &amp; 2 Ave</td>
<td align="right">40.73047</td>
<td align="right">-73.98672</td>
<td align="right">237</td>
<td align="left">E 11 St &amp; 2 Ave</td>
<td align="right">40.73047</td>
<td align="right">-73.98672</td>
<td align="right">15087</td>
<td align="left">Customer</td>
<td align="right">1994</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The citibike dataframe includes 22808798 trips and 17 variables. The
variables in the dataframe are files, path, tripduration, starttime,
stoptime, start station id, start station name, start station latitude,
start station longitude, end station id, end station name, end station
latitude, end station longitude, bikeid, usertype, birth year,
gender.</p>
<p> </p>
</div>
<div id="data-cleaning" class="section level5">
<h5>Data Cleaning</h5>
<p>The cleaning of the citibike data included the following steps:</p>
<ul>
<li>Recoding gender from numeric to text</li>
<li>Filtering trip duration to more than 5 minutes but less than 1 day
in order to capture true trips taken</li>
<li>Including trips that started in 2018 but ended in 2019 and trips
that started in 2019 but ended in 2020, so as to include all trips taken
in 2019</li>
<li>Creating an age at time of trip variable from birth year</li>
<li>Creating a trip duration in minutes (as opposed to seconds)
variable</li>
<li>Renaming variables</li>
</ul>
<pre class="r"><code>citibike_df &lt;- citibike |&gt;
  janitor::clean_names() |&gt;
  select(-files, -path, -start_station_id, -end_station_id) |&gt;
  rename(trip_duration_sec = tripduration,
         start_time = starttime,
         stop_time = stoptime,
         user_type = usertype)|&gt;
  mutate(gender = recode(gender,
                         &quot;0&quot; = &quot;Unknown&quot;,
                         &quot;1&quot; = &quot;Male&quot;,
                         &quot;2&quot; = &quot;Female&quot;),
        trip_duration_min = trip_duration_sec / 60,
        age = 2019 - birth_year
        ) |&gt;
  filter(
    trip_duration_sec &gt;= 300,
    trip_duration_sec &lt;= 86400,
    as.Date(stop_time) &gt;= as.Date(&quot;2019-01-01&quot;),
    as.Date(start_time) &lt;= as.Date(&quot;2019-12-31&quot;)
  )  |&gt;
  select(trip_duration_sec, trip_duration_min, everything())</code></pre>
<p>The table below displays the citibike tidied data.</p>
<pre class="r"><code>citibike_df |&gt;
  head() |&gt;
  knitr::kable()</code></pre>
<table style="width:100%;">
<colgroup>
<col width="6%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
<col width="10%" />
<col width="8%" />
<col width="9%" />
<col width="9%" />
<col width="8%" />
<col width="8%" />
<col width="2%" />
<col width="4%" />
<col width="4%" />
<col width="3%" />
<col width="1%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">trip_duration_sec</th>
<th align="right">trip_duration_min</th>
<th align="left">start_time</th>
<th align="left">stop_time</th>
<th align="left">start_station_name</th>
<th align="right">start_station_latitude</th>
<th align="right">start_station_longitude</th>
<th align="left">end_station_name</th>
<th align="right">end_station_latitude</th>
<th align="right">end_station_longitude</th>
<th align="right">bikeid</th>
<th align="left">user_type</th>
<th align="right">birth_year</th>
<th align="left">gender</th>
<th align="right">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">62663</td>
<td align="right">1044.3833</td>
<td align="left">2018-12-31 12:42:23</td>
<td align="left">2019-01-01 06:06:47</td>
<td align="left">Lafayette St &amp; Jersey St</td>
<td align="right">40.72431</td>
<td align="right">-73.99601</td>
<td align="left">W 42 St &amp; 8 Ave</td>
<td align="right">40.75757</td>
<td align="right">-73.99099</td>
<td align="right">19573</td>
<td align="left">Customer</td>
<td align="right">2000</td>
<td align="left">Female</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="right">86324</td>
<td align="right">1438.7333</td>
<td align="left">2018-12-31 13:21:55</td>
<td align="left">2019-01-01 13:20:39</td>
<td align="left">11 Ave &amp; W 27 St</td>
<td align="right">40.75140</td>
<td align="right">-74.00523</td>
<td align="left">Barrow St &amp; Hudson St</td>
<td align="right">40.73172</td>
<td align="right">-74.00674</td>
<td align="right">16996</td>
<td align="left">Subscriber</td>
<td align="right">1953</td>
<td align="left">Female</td>
<td align="right">66</td>
</tr>
<tr class="odd">
<td align="right">77833</td>
<td align="right">1297.2167</td>
<td align="left">2018-12-31 16:54:58</td>
<td align="left">2019-01-01 14:32:11</td>
<td align="left">Greene Ave &amp; Nostrand Ave</td>
<td align="right">40.68833</td>
<td align="right">-73.95092</td>
<td align="left">Macon St &amp; Nostrand Ave</td>
<td align="right">40.68098</td>
<td align="right">-73.95005</td>
<td align="right">15420</td>
<td align="left">Customer</td>
<td align="right">1969</td>
<td align="left">Unknown</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="right">52587</td>
<td align="right">876.4500</td>
<td align="left">2018-12-31 17:37:05</td>
<td align="left">2019-01-01 08:13:33</td>
<td align="left">E 58 St &amp; Madison Ave</td>
<td align="right">40.76303</td>
<td align="right">-73.97210</td>
<td align="left">E 58 St &amp; Madison Ave</td>
<td align="right">40.76303</td>
<td align="right">-73.97210</td>
<td align="right">28349</td>
<td align="left">Subscriber</td>
<td align="right">1966</td>
<td align="left">Female</td>
<td align="right">53</td>
</tr>
<tr class="odd">
<td align="right">76290</td>
<td align="right">1271.5000</td>
<td align="left">2018-12-31 18:00:44</td>
<td align="left">2019-01-01 15:12:14</td>
<td align="left">Lenox Ave &amp; W 111 St</td>
<td align="right">40.79879</td>
<td align="right">-73.95230</td>
<td align="left">Columbus Ave &amp; W 72 St</td>
<td align="right">40.77706</td>
<td align="right">-73.97898</td>
<td align="right">14710</td>
<td align="left">Subscriber</td>
<td align="right">1995</td>
<td align="left">Female</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="right">51131</td>
<td align="right">852.1833</td>
<td align="left">2018-12-31 18:40:45</td>
<td align="left">2019-01-01 08:52:56</td>
<td align="left">Underhill Ave &amp; Lincoln Pl</td>
<td align="right">40.67401</td>
<td align="right">-73.96715</td>
<td align="left">Park Pl &amp; Vanderbilt Ave</td>
<td align="right">40.67670</td>
<td align="right">-73.96902</td>
<td align="right">16935</td>
<td align="left">Customer</td>
<td align="right">1987</td>
<td align="left">Male</td>
<td align="right">32</td>
</tr>
</tbody>
</table>
<p>The citibike dataframe includes 16893163 trips and 15 variables. The
variables in the dataframe are trip_duration_sec, trip_duration_min,
start_time, stop_time, start_station_name, start_station_latitude,
start_station_longitude, end_station_name, end_station_latitude,
end_station_longitude, bikeid, user_type, birth_year, gender, age.</p>
<p> </p>
</div>
</div>
<div id="social-deprivation-index" class="section level3">
<h3><em>Social Deprivation Index</em></h3>
<p> </p>
<div id="data-import-and-cleaning" class="section level5">
<h5>Data Import and Cleaning</h5>
<p>The SDI dataset was a csv. We renamed the zip code variable to be
more intuitive. As we were only interested in the entirety of the SDI
score, we filtered the data to include zip code and sdi_score only.</p>
<ul>
<li>It is important to note that the higher the SDI score the higher the
social deprivation in that area.</li>
</ul>
<pre class="r"><code>SDI_df &lt;- read_csv(&quot;data/SDI_data/rgcsdi-2015-2019-zcta.csv&quot;) |&gt;
  janitor::clean_names() |&gt;
  select(zcta5_fips, sdi_score)|&gt;
  rename(zip=zcta5_fips)</code></pre>
<pre><code>## Rows: 32989 Columns: 18
## ── Column specification ───────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (1): ZCTA5_FIPS
## dbl (17): ZCTA5_population, SDI_score, PovertyLT100_FPL_score, Single_Parent...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>This table shows the first few rows of the sdi dataframe.</p>
<pre class="r"><code>SDI_df |&gt;
  head() |&gt;
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">zip</th>
<th align="right">sdi_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01001</td>
<td align="right">36</td>
</tr>
<tr class="even">
<td align="left">01002</td>
<td align="right">72</td>
</tr>
<tr class="odd">
<td align="left">01003</td>
<td align="right">76</td>
</tr>
<tr class="even">
<td align="left">01005</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">01007</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">01008</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
<p> </p>
</div>
</div>
<div id="overweight-data" class="section level3">
<h3><em>Overweight Data</em></h3>
<p> </p>
<div id="data-import-1" class="section level5">
<h5>Data Import</h5>
<p>The overweight data was a csv files that we downloaded and merged. We
were specifically interested in 2019 as this was when SDI scores were
available.</p>
<pre class="r"><code>overweight = read_csv(&#39;./data/SDI_data/nyc_overweight_or_obesity_adults.csv&#39;) |&gt;
    janitor::clean_names()</code></pre>
<pre><code>## Rows: 720 Columns: 7
## ── Column specification ───────────────────────────────
## Delimiter: &quot;,&quot;
## chr (4): GeoType, Geography, Number, Percent
## dbl (3): Time, GeoID, GeoRank
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p> </p>
</div>
<div id="data-cleaning-1" class="section level5">
<h5>Data Cleaning</h5>
<p>The cleaning of the overweight data included the following steps:</p>
<ul>
<li>Converting percent from a character variable to a numeric
variable</li>
<li>Separating out the high and low confidence intervals of percent</li>
<li>Renaming time to year</li>
<li>Filtering data to 2019</li>
</ul>
<pre class="r"><code>overweight_df =
 overweight |&gt;
  mutate(number = gsub(&quot;\\*&quot;, &quot;&quot;, number)) |&gt;
  mutate(number = gsub(&quot;,&quot;, &quot;&quot;, number)) |&gt;
  mutate(number = as.numeric(number)) |&gt;
  mutate(
    percent_low = as.numeric(gsub(&quot;^.*\\(\\s*&quot;, &quot;&quot;, gsub(&quot;\\s*,.*$&quot;, &quot;&quot;, percent))),
    percent_high = as.numeric(gsub(&quot;^.*\\,\\s*&quot;, &quot;&quot;, gsub(&quot;\\)$&quot;, &quot;&quot;, percent))),
percent = as.numeric(ifelse(grepl(&quot;\\*&quot;, percent),
                                gsub(&quot;\\*.*$&quot;, &quot;&quot;, percent),
                                gsub(&quot;\\s*\\(.*&quot;, &quot;&quot;, percent)))) |&gt;
  rename(year = time)|&gt;
  filter (year == 2019)</code></pre>
<p>The table below displays the overweight tidied data.</p>
<pre class="r"><code>overweight_df |&gt;
  head() |&gt;
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="5%" />
<col width="9%" />
<col width="7%" />
<col width="9%" />
<col width="27%" />
<col width="7%" />
<col width="8%" />
<col width="12%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="left">geo_type</th>
<th align="right">geo_id</th>
<th align="right">geo_rank</th>
<th align="left">geography</th>
<th align="right">number</th>
<th align="right">percent</th>
<th align="right">percent_low</th>
<th align="right">percent_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">101</td>
<td align="right">3</td>
<td align="left">Kingsbridge - Riverdale</td>
<td align="right">37000</td>
<td align="right">52.4</td>
<td align="right">40.8</td>
<td align="right">63.8</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">102</td>
<td align="right">3</td>
<td align="left">Northeast Bronx</td>
<td align="right">103000</td>
<td align="right">69.6</td>
<td align="right">59.7</td>
<td align="right">78.0</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">103</td>
<td align="right">3</td>
<td align="left">Fordham - Bronx Pk</td>
<td align="right">122000</td>
<td align="right">71.1</td>
<td align="right">61.1</td>
<td align="right">79.3</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">104</td>
<td align="right">3</td>
<td align="left">Pelham - Throgs Neck</td>
<td align="right">152000</td>
<td align="right">66.4</td>
<td align="right">58.7</td>
<td align="right">73.4</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">201</td>
<td align="right">3</td>
<td align="left">Greenpoint</td>
<td align="right">40000</td>
<td align="right">41.8</td>
<td align="right">31.0</td>
<td align="right">53.6</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">202</td>
<td align="right">3</td>
<td align="left">Downtown - Heights - Slope</td>
<td align="right">86000</td>
<td align="right">50.8</td>
<td align="right">41.8</td>
<td align="right">59.7</td>
</tr>
</tbody>
</table>
<p>The overweight dataframe now includes 40 rows and 9 variables. The
variables in the dataframe are year, geo_type, geo_id, geo_rank,
geography, number, percent, percent_low, percent_high.</p>
<p> </p>
</div>
</div>
<div id="air-quality-index" class="section level3">
<h3><em>Air Quality Index</em></h3>
<div id="data-import-2" class="section level5">
<h5>Data Import</h5>
<p>The air quality data was a csv files.</p>
<pre class="r"><code>air &lt;- read_csv(&quot;data/air_quality/Air_Quality_20231126.csv&quot;) </code></pre>
<pre><code>## Rows: 16218 Columns: 12
## ── Column specification ───────────────────────────────
## Delimiter: &quot;,&quot;
## chr (7): Name, Measure, Measure Info, Geo Type Name, Geo Place Name, Time Pe...
## dbl (4): Unique ID, Indicator ID, Geo Join ID, Data Value
## lgl (1): Message
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p> </p>
</div>
<div id="data-cleaning-2" class="section level5">
<h5>Data Cleaning</h5>
<p>The cleaning of the air quality index data included the following
steps:</p>
<ul>
<li>Separating out year</li>
<li>Filtering data to 2019</li>
</ul>
<pre class="r"><code> air_quality_df =air |&gt;
  janitor::clean_names() |&gt;
  mutate(
    start_date = mdy(start_date),
    year = year(start_date)
  ) |&gt;
  filter(year == &quot;2019&quot;)</code></pre>
<p>The table below displays the air quality tidied data.</p>
<pre class="r"><code> air_quality_df |&gt;
  head() |&gt;
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="5%" />
<col width="7%" />
<col width="12%" />
<col width="4%" />
<col width="7%" />
<col width="7%" />
<col width="6%" />
<col width="20%" />
<col width="10%" />
<col width="5%" />
<col width="5%" />
<col width="4%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">unique_id</th>
<th align="right">indicator_id</th>
<th align="left">name</th>
<th align="left">measure</th>
<th align="left">measure_info</th>
<th align="left">geo_type_name</th>
<th align="right">geo_join_id</th>
<th align="left">geo_place_name</th>
<th align="left">time_period</th>
<th align="left">start_date</th>
<th align="right">data_value</th>
<th align="left">message</th>
<th align="right">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">643618</td>
<td align="right">375</td>
<td align="left">Nitrogen dioxide (NO2)</td>
<td align="left">Mean</td>
<td align="left">ppb</td>
<td align="left">CD</td>
<td align="right">212</td>
<td align="left">Williamsbridge and Baychester (CD12)</td>
<td align="left">Annual Average 2019</td>
<td align="left">2019-01-01</td>
<td align="right">14.19</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="even">
<td align="right">643339</td>
<td align="right">375</td>
<td align="left">Nitrogen dioxide (NO2)</td>
<td align="left">Mean</td>
<td align="left">ppb</td>
<td align="left">UHF42</td>
<td align="right">201</td>
<td align="left">Greenpoint</td>
<td align="left">Annual Average 2019</td>
<td align="left">2019-01-01</td>
<td align="right">21.40</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="odd">
<td align="right">643577</td>
<td align="right">375</td>
<td align="left">Nitrogen dioxide (NO2)</td>
<td align="left">Mean</td>
<td align="left">ppb</td>
<td align="left">CD</td>
<td align="right">110</td>
<td align="left">Central Harlem (CD10)</td>
<td align="left">Summer 2019</td>
<td align="left">2019-06-01</td>
<td align="right">16.80</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="even">
<td align="right">667586</td>
<td align="right">375</td>
<td align="left">Nitrogen dioxide (NO2)</td>
<td align="left">Mean</td>
<td align="left">ppb</td>
<td align="left">CD</td>
<td align="right">112</td>
<td align="left">Washington Heights and Inwood (CD12)</td>
<td align="left">Winter 2019-20</td>
<td align="left">2019-12-01</td>
<td align="right">24.28</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="odd">
<td align="right">667730</td>
<td align="right">375</td>
<td align="left">Nitrogen dioxide (NO2)</td>
<td align="left">Mean</td>
<td align="left">ppb</td>
<td align="left">CD</td>
<td align="right">312</td>
<td align="left">Borough Park (CD12)</td>
<td align="left">Winter 2019-20</td>
<td align="left">2019-12-01</td>
<td align="right">25.93</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="even">
<td align="right">667646</td>
<td align="right">375</td>
<td align="left">Nitrogen dioxide (NO2)</td>
<td align="left">Mean</td>
<td align="left">ppb</td>
<td align="left">CD</td>
<td align="right">210</td>
<td align="left">Throgs Neck and Co-op City (CD10)</td>
<td align="left">Winter 2019-20</td>
<td align="left">2019-12-01</td>
<td align="right">21.25</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
</tbody>
</table>
<p>The air quality dataframe now includes 987 rows and 13 variables. The
variables in the dataframe are unique_id, indicator_id, name, measure,
measure_info, geo_type_name, geo_join_id, geo_place_name, time_period,
start_date, data_value, message, year.</p>
<hr />
</div>
</div>
</div>
<div id="data-merging-by-nyc-neighborhood" class="section level2">
<h2><span style="color: blue;">Data Merging by NYC
Neighborhood</span></h2>
<p>Our end goal was to merge data by neighborhood. We decided to use
United Hospital (UHF) 42 codes which consists of 34 adjoining zip codes
with similar characteristics compiled by NYC Gov. We used UFH 34
(instead of other UFH versions) as UFH 34 had the least number of
neighborhoods (contains the largest area per neighborhood)</p>
<ul>
<li>For more information about the background behind UHF codes, please
see <a
href="https://a816-dohbesp.nyc.gov/IndicatorPublic/data-stories/geographies/"><strong>here</strong></a>.</li>
</ul>
<p>We did the following:</p>
<ol style="list-style-type: decimal">
<li>First we combined United Hospital (UHF) 42 codes to zip codes, as
the overweight dataframe included UHF 42 codes. We found a table that
mapped UFH 42 codes to zip codes from a NYC gov <a
href="https://www.nyc.gov/assets/doh/downloads/pdf/ah/zipcodetable.pdf%60"><strong>pdf</strong></a>.
We imported this table and tidied it into a dataframe.</li>
</ol>
<pre class="r"><code># install.packages(&quot;pdftables&quot;)
# install.packages(&quot;pdftools&quot;)

uhf_zip = 
  pdf_text(&quot;data/geocoding/zipcodetable.pdf&quot;)

uhf_zip_df =
  uhf_zip |&gt; 
  str_split(&quot;\n&quot;) |&gt;
  tibble() |&gt; 
  rename(&quot;data&quot; = &quot;str_split(uhf_zip, \&quot;\\n\&quot;)&quot;) |&gt; 
  unnest(&quot;data&quot;) |&gt;     
  filter(data != &quot;&quot;) |&gt; 
  filter(!row_number() %in% c(1, 2, 51)) |&gt; 
  filter(!row_number() %in% c(1, 2, 10, 22, 33, 44)) |&gt; 
  mutate(data = str_squish(data)) |&gt; 
  mutate(data = str_remove_all(data, &quot;-&quot;)) |&gt; 
  mutate(data = str_squish(data)) |&gt; 
  separate(data, into = c(&quot;uhf&quot;, &quot;rest&quot;), sep = &quot;(?&lt;=\\d\\s)&quot;) |&gt; 
  separate(col = &quot;rest&quot;, into = c(&quot;neighborhood&quot;, &quot;zip&quot;), sep = &quot;(?=\\s\\d)&quot;, extra = &quot;merge&quot;) |&gt; 
  separate(col = &quot;zip&quot;, into = c(&quot;zip1&quot;, &quot;zip2&quot;, &quot;zip3&quot;, &quot;zip4&quot;, &quot;zip5&quot;, &quot;zip6&quot;, &quot;zip7&quot;, &quot;zip8&quot;, &quot;zip9&quot;), sep = &quot;,&quot;) |&gt; 
  mutate(across(everything(), ~ str_trim(.x))) |&gt; 
  mutate(across(c(&quot;zip1&quot;:&quot;zip9&quot;), ~ as.numeric(.x))) |&gt; 
  mutate(uhf = as.numeric(uhf)) |&gt; 
  pivot_longer(c(zip1:zip9), names_to = &quot;zip_name&quot;, values_to = &quot;zip&quot;) |&gt; 
  filter(!is.na(zip)) |&gt; 
  select(!zip_name)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>We imported and cleaned a dataframe that converted UFH 34 to zip
code.</li>
</ol>
<pre class="r"><code>uhf_34 = 
  pdf_text(&quot;data/geocoding/uhf34.pdf&quot;)

uhf_34_df =
  uhf_34 |&gt; 
  str_split(&quot;\n&quot;) |&gt;
  tibble() |&gt; 
  rename(&quot;data&quot; = &quot;str_split(uhf_34, \&quot;\\n\&quot;)&quot;) |&gt; 
  unnest(&quot;data&quot;) |&gt; 
  filter(data != &quot;&quot;) |&gt; 
  mutate(data = str_squish(data)) |&gt; 
  filter(!row_number() %in% c(1, 2, 7, 14, 18, 21, 24, 27, 28, 31, 32, 34, 35, 39, 40, 42, 43, 44, 45, 47, 48, 52, 53, 57, 61:75)) |&gt; 
  mutate(data = str_replace(data, &quot;Kingsbridge - Riverdale&quot;, &quot;101 Kingsbridge - Riverdale&quot;)) |&gt; 
  mutate(data = str_replace(data, &quot;Northeast Bronx&quot;, &quot;102 Northeast Bronx&quot;)) |&gt; 
  filter(!row_number() %in% c(1,2)) |&gt; 
  mutate(data = str_remove_all(data, &quot;-&quot;),
         data = str_squish(data), 
         data = str_trim(data)) |&gt;
  mutate(data = str_remove(data, &quot;(\\d)+$&quot;)) |&gt;
  mutate(data = str_remove(data, &quot;(\\d)+\\s$&quot;)) |&gt;
  separate(data, into = c(&quot;uhf34&quot;, &quot;neighborhood&quot;), sep = &quot;(?&lt;=\\d\\s)&quot;) |&gt; 
  mutate(uhf34 = as.numeric(str_trim(uhf34)),
         neighborhood = str_trim(neighborhood)) |&gt; 
  mutate(uhf2 = uhf34) |&gt; 
  separate_wider_position(uhf2, widths = c(&quot;1_uhf&quot; = 3, &quot;2_uhf&quot; = 3, &quot;3_uhf&quot; = 3), too_few = &quot;align_start&quot;) |&gt; 
  pivot_longer(c(&quot;1_uhf&quot;:&quot;3_uhf&quot;), names_to = &quot;uhf_name&quot;, values_to = &quot;uhf42&quot;) |&gt; 
  select(!uhf_name) |&gt; 
  mutate(uhf34 = as.numeric(uhf34),
         uhf42 = as.numeric(uhf42))</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>We combined UFH 42 and UFH 34 dataframes to create a neighborhood
crosswalk dataframe.</li>
</ol>
<pre class="r"><code>joined_uhf_34_42 = 
  uhf_zip_df |&gt; 
  left_join(y = uhf_34_df, by = join_by(&quot;uhf&quot; == &quot;uhf42&quot;)) |&gt; 
  rename(&quot;uhf34_neighborhood&quot; = &quot;neighborhood.y&quot;, 
         &quot;uhf42_neighborhood&quot; = &quot;neighborhood.x&quot;, 
         &quot;uhf42&quot; = &quot;uhf&quot;)</code></pre>
<hr />
</div>
<div id="joining-citibike-to-ufh-34-neighborhood-dataframe"
class="section level2">
<h2><span style="color: blue;">Joining citibike to UFH 34 Neighborhood
Dataframe</span></h2>
<p>The citibike data contained latitude/longitude, but we wanted our
final location variable to be UHF 34 neighborhood. To do this, we did
the following:</p>
<ol style="list-style-type: decimal">
<li>First, we need to convert the Citibike location data from
latitude/longitude to zip code.This was done using a package <a
href="https://jessecambon.github.io/tidygeocoder/">tidygeocoder</a>.
Here, we import the latitude/longitude to zipcode crosswalk we
generated. The full code with details of how that was created <a
href="latlong_to_zip.html">can be found here</a>.</li>
</ol>
<pre class="r"><code>latlong_zip = read_csv(&#39;./data/geocoding/citibike_latlong_zip.csv&#39;)</code></pre>
<pre><code>## Rows: 1090 Columns: 3
## ── Column specification ───────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (3): latitude, longitude, postcode
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>citibike_zip =
  citibike_df |&gt;
  left_join(latlong_zip, 
            by = c(&quot;start_station_latitude&quot; = &quot;latitude&quot;,
                   &quot;start_station_longitude&quot; = &quot;longitude&quot;)) |&gt;
  rename(&quot;start_zipcode&quot; = &quot;postcode&quot;) |&gt;
  left_join(latlong_zip, 
            by = c(&quot;end_station_latitude&quot; = &quot;latitude&quot;,
                   &quot;end_station_longitude&quot; = &quot;longitude&quot;)) |&gt;
  rename(&quot;end_zipcode&quot; = &quot;postcode&quot;) </code></pre>
<p>There are 804243 entries missing either the start or end zipcode.</p>
<ol start="2" style="list-style-type: decimal">
<li>So next, we manually added the missing zipcodes into the
dataframe.</li>
</ol>
<pre class="r"><code>citibike_zip = citibike_zip |&gt;
  mutate(start_zipcode = case_when(start_station_name == &quot;Broadway &amp; W 32 St&quot; ~ 10001,
                               start_station_name == &quot;Cooper Square &amp; Astor Pl&quot; ~ 10003,
                               start_station_name == &quot;William St &amp; Pine St&quot; ~ 10005,
                               start_station_name %in% c(&quot;Broadway &amp; W 36 St&quot;,&quot;Broadway &amp; W 37 St&quot;,&quot;Broadway &amp; W 38 St&quot;,&quot;Broadway &amp; W 41 St&quot;) ~ 10018,
                               start_station_name == &quot;W 52 St &amp; 6 Ave&quot; ~ 100019,
                               start_station_name %in% c(&quot;Broadway &amp; W 41 St&quot;,&quot;W 43 St &amp; 6 Ave&quot;) ~ 10036,
                               start_station_name == &quot;South St &amp; Gouverneur Ln&quot; ~ 10043,
                               start_station_name == &quot;E 47 St &amp; 1 Ave&quot; ~ 10075,
                               start_station_name == &quot;Roebling St &amp; N 4 St&quot; ~ 11211,
                               TRUE ~ start_zipcode)) |&gt;
  mutate(end_zipcode = case_when(end_station_name == &quot;Broadway &amp; W 32 St&quot; ~ 10001,
                               end_station_name == &quot;Cooper Square &amp; Astor Pl&quot; ~ 10003,
                               end_station_name == &quot;William St &amp; Pine St&quot; ~ 10005,
                               end_station_name %in% c(&quot;Broadway &amp; W 36 St&quot;,&quot;Broadway &amp; W 37 St&quot;,&quot;Broadway &amp; W 38 St&quot;,&quot;Broadway &amp; W 41 St&quot;) ~ 10018,
                               end_station_name == &quot;W 52 St &amp; 6 Ave&quot; ~ 100019,
                               end_station_name %in% c(&quot;Broadway &amp; W 41 St&quot;,&quot;W 43 St &amp; 6 Ave&quot;) ~ 10036,
                               end_station_name == &quot;South St &amp; Gouverneur Ln&quot; ~ 10043,
                               end_station_name == &quot;E 47 St &amp; 1 Ave&quot; ~ 10075,
                               end_station_name == &quot;Roebling St &amp; N 4 St&quot; ~ 11211,
                               TRUE ~ end_zipcode))</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Then we merged the citibike dataframe with the neighborhood
dataframe by zip code.</li>
</ol>
<pre class="r"><code>citibike_zip_neighborhoods =
  citibike_zip |&gt;
  left_join(y = (joined_uhf_34_42 |&gt; select(zip, uhf42_neighborhood, uhf34_neighborhood)),
            by = join_by(&quot;start_zipcode&quot; == &quot;zip&quot;)) |&gt; 
  rename(&quot;start_uhf34_neighborhood&quot; = &quot;uhf34_neighborhood&quot;,
         &quot;start_uhf42_neighborhood&quot; = &quot;uhf42_neighborhood&quot;) |&gt; 
  left_join(y = (joined_uhf_34_42 |&gt; select(zip, uhf42_neighborhood, uhf34_neighborhood)),
            by = join_by(&quot;end_zipcode&quot; == &quot;zip&quot;)) |&gt; 
  rename(&quot;end_uhf34_neighborhood&quot; = &quot;uhf34_neighborhood&quot;,
         &quot;end_uhf42_neighborhood&quot; = &quot;uhf42_neighborhood&quot;)</code></pre>
<p>We performed a check to see if there were missing UHF 34 codes.</p>
<pre class="r"><code>missing_startuhf = citibike_zip_neighborhoods |&gt;
  filter(is.na(start_uhf34_neighborhood)) |&gt;
  group_by(start_zipcode) |&gt;
  summarize(n = n()) |&gt;
  rename(zipcode = start_zipcode)
  
missing_enduhf = citibike_zip_neighborhoods |&gt;
  filter(is.na(end_uhf34_neighborhood)) |&gt;
  group_by(end_zipcode) |&gt;
  summarize(n = n()) |&gt;
  rename(zipcode = end_zipcode)

citibike_zip_neighborhoods = citibike_zip_neighborhoods |&gt;
  filter(is.na(end_uhf34_neighborhood) | is.na(start_uhf34_neighborhood))</code></pre>
<p>We noticed that there were 1963674 entries whose start zipcode do not
have an associated uhf34, and 1989338 entries whose end zipcode do not
have an associated uhf34. This corresponded to 28 start zip codes and 35
end zip codes. Manual validation showed these zipcodes are business
zipcodes, where a zipcode refers to a small domain of a business. While
these can be pinpointed roughly to a UHF34 neighborhood manually, it is
cleaner to simply omit them, as we still retain a substantial dataset
size. The resulting dataset has 3579463 entries.</p>
<hr />
</div>
<div
id="finally-merge-citibike-social-deprivation-index-overweight-and-air-quality-index-data"
class="section level2">
<h2><span style="color: blue;">Finally, Merge Citibike, Social
Deprivation Index, Overweight, and Air Quality Index Data </span></h2>
<p>Next we needed to create one large dataframe that merged the citibike
dataframe and each individual variable dataframe by UFH 34
neighborhood.</p>
<p>We did the following:</p>
<ol style="list-style-type: decimal">
<li>Join SDI data to neighborhood dataframe</li>
</ol>
<pre class="r"><code>joined_SDI_zip_neighborhood = 
  SDI_df |&gt; 
  filter(zip %in% pull(joined_uhf_34_42, zip)) |&gt; 
  mutate(zip = as.numeric(zip)) |&gt; 
  left_join(y = joined_uhf_34_42, by = &quot;zip&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Join overweight data to neighborhood dataframe</li>
</ol>
<pre class="r"><code>joined_overweight_zip_neighborhood = 
  overweight_df |&gt; 
  left_join(y = joined_uhf_34_42, by = join_by(&quot;geo_id&quot; == &quot;uhf34&quot;)) |&gt;
  rename(percent_overweight = percent)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Join overweight and sdi dataframes by uhf42</li>
</ol>
<pre class="r"><code>sdi_overweight = 
  merge(joined_overweight_zip_neighborhood, joined_SDI_zip_neighborhood,
                   by.x = c(&quot;zip&quot;, &quot;uhf42&quot;, &quot;uhf42_neighborhood&quot;),
                   by.y = c(&quot;zip&quot;, &quot;uhf42&quot;, &quot;uhf42_neighborhood&quot;),
                   all.x = TRUE)  |&gt;
  select(&quot;zip&quot;,&quot;uhf34&quot;,&quot;uhf34_neighborhood.x&quot;,&quot;uhf42&quot;,&quot;uhf42_neighborhood&quot;,
         &quot;sdi_score&quot;,&quot;percent_overweight&quot;) |&gt;
  rename(uhf34_neighborhood = uhf34_neighborhood.x) |&gt;
  filter(!is.na(zip)) </code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Join air quality to neighborhood datafame</li>
</ol>
<pre class="r"><code>air_quality_df = 
  left_join(air_quality_df, uhf_34_df, by = c(&quot;geo_join_id&quot; = &quot;uhf34&quot;))

air_quality_df =
  air_quality_df |&gt;
select(data_value, neighborhood ) |&gt;
 distinct()</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Join SDI/Overweight dataframe with citibike dataframe</li>
</ol>
<pre class="r"><code>citibike_df =
  citibike_zip_neighborhoods |&gt;
  left_join(y = sdi_overweight,
            by = join_by(&quot;start_zipcode&quot; == &quot;zip&quot;)) |&gt;
  rename(&quot;start_sdi_score&quot; = &quot;sdi_score&quot;,
         &quot;start_percent_overweight&quot; = &quot;percent_overweight&quot;) 

remove(citibike_zip_neighborhoods)

citibike_df = citibike_df |&gt;
  left_join(y = sdi_overweight,
            by = join_by(&quot;end_zipcode&quot; == &quot;zip&quot;)) |&gt;
  rename(&quot;end_sdi_score&quot; = &quot;sdi_score&quot;,
         &quot;end_percent_overweight&quot; = &quot;percent_overweight&quot;) </code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Join air quality dataframe with citibike dataframe</li>
</ol>
<pre class="r"><code>citibike_df =
  citibike_df |&gt;
  left_join(y = air_quality_df,
            by = join_by(&quot;start_uhf34_neighborhood&quot; == &quot;neighborhood&quot;)) |&gt;
  rename(&quot;start_aq&quot; = &quot;data_value&quot;)

citibike_df = citibike_df |&gt;
  left_join(y = air_quality_df,
            by = join_by(&quot;end_uhf34_neighborhood&quot; == &quot;neighborhood&quot;)) |&gt;
  rename(&quot;end_aq&quot; = &quot;data_value&quot;)</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Perform final Tidy of Citibike Data</li>
</ol>
<pre class="r"><code>citibike_df = citibike_df |&gt;
  select(bikeid, user_type, gender, age,
         start_time, stop_time, 
         start_station_id, start_station_name,
         start_zipcode, start_uhf34_neighborhood,
         end_station_id, end_station_name,
         end_zipcode, end_uhf34_neighborhood,
         start_sdi_score, start_percent_overweight, start_aq,
         end_sdi_score, end_percent_overweight, end_aq)</code></pre>
<p>The table below shows the first few rows of the final version of the
citibike dataframe.</p>
<pre class="r"><code>head(citibike_df) |&gt;
  knitr::kable()</code></pre>
<p>The citibike dataframe includes r nrow(citibike) trips and r
ncol(citibike) variables. The variables in the dataframe are r
names(citibike).</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
