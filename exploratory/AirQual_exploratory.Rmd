---
title: "AirQuality Dataset Exploratoration"
output: html_document
---
```{r setup, include=FALSE}
library(tidyverse)
```

To explore the impact of weather trends on Citibike ridership in New York City, we used [Air Quality](https://data.cityofnewyork.us/Environment/Air-Quality/c3uy-2p5r) dataset from the [NYC Open Data](https://opendata.cityofnewyork.us/), provided by the Department of Hygiene and Mental Health. 

This dataset includes air quality indexes measured across NYC boroughs. Our analysis aims to uncover relationships between air quality variations and Citibike ridership, offering insights into how environmental factors influence urban mobility patterns.

## Air Quality Exploratory analyses
```{r}
#import data
air <- read_csv("data/air_quality/Air_Quality_20231126.csv") 
joined_uhf_34_42 <- read_csv("data/geocoding/joined_uhf_34_42.csv") 

#Air Quality tidy
air_quality_df = air |>
  janitor::clean_names() |>
  mutate(
    start_date = mdy(start_date),
    year = year(start_date)
  ) |>
  filter(year == "2019")
```

```{r}
# add zip codes
# the original data includes several varieties of geo ids, including borough, citywide, uhf42, ,uhf34, and CD (Community Districts). We decided to use uhf42 and uhf34 with zipcodes, so the other geo id varieties will be filtered out. 

air_geo =
  air_quality_df |>
  mutate(
    uhf42 = case_when(geo_type_name == "UHF42" ~ "1"),
    uhf34 = case_when(geo_type_name == "UHF34" ~ "1")
  )

# break up by geocoding system, add zipcodes
#uhf42
air_zip_neighborhoods_42 =
  air_geo |>
  filter(uhf42 == "1") |>
  select(-uhf42, -uhf34, - message)

air_zip_neighborhoods_42 =
  left_join(air_zip_neighborhoods_42, y = (joined_uhf_34_42),
            by = join_by("geo_join_id" == "uhf42")) 

air_zip_neighborhoods_42 =
  air_zip_neighborhoods_42 |>
  select(-uhf34, -uhf34_neighborhood, -uhf42_neighborhood) |>
filter(!duplicated(unique_id))

# uhf34
air_zip_neighborhoods_34 =
  air_geo |>
  filter(uhf34 == "1") |>
  select(-uhf42, -uhf34, - message)

air_zip_neighborhoods_34 =
  left_join(air_zip_neighborhoods_34, y = (joined_uhf_34_42),
            by = join_by("geo_join_id" == "uhf34")) 

air_zip_neighborhoods_34 =
  air_zip_neighborhoods_34 |>
  select(-uhf34_neighborhood, -uhf42_neighborhood, - uhf42) |>
filter(!duplicated(unique_id))

# bind uhf frames
air_zip_uhf = 
  bind_rows(air_zip_neighborhoods_34, air_zip_neighborhoods_42)

```

Average Air Quality Index Across Time Periods
```{r}
air_quality_df |>
  group_by(time_period) |>
  summarise(avg_air_quality = mean(data_value)) |>
  ggplot(aes(x = reorder(time_period, avg_air_quality), y = avg_air_quality)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Average Air Quality Index Across Time Periods",
       x = "Time Period",
       y = "Average Air Quality Index") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
```

Air Quality Comparison
```{r}
air_quality_df |>
  ggplot(aes(x = reorder(geo_place_name, data_value), y = data_value)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  facet_wrap(~ name + measure_info, scales = "free_y", ncol = 3) +
  labs(title = "Air Quality Comparison",
       x = "Geographical Place",
       y = "Data Value") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5))
```

The minimum, first quartile (Q1), median, third quartile (Q3), and maximum values for each pollutant.
```{r}
air_quality_df |>
  group_by(name) |>
  summarise(
    min_value = min(data_value, na.rm = TRUE),
    q1 = quantile(data_value, 0.25, na.rm = TRUE),
    median_value = median(data_value, na.rm = TRUE),
    q3 = quantile(data_value, 0.75, na.rm = TRUE),
    max_value = max(data_value, na.rm = TRUE)
  )
```

Distribution of Air Quality Pollutants
```{r}
air_quality_df |>
  ggplot(aes(x = data_value, fill = name)) +
  geom_histogram(binwidth = 1, position = "dodge", alpha = 0.7) +
  facet_wrap(~ name, scales = "free") +
  labs(title = "Distribution of Air Quality Pollutants",
       x = "Data Value",
       y = "Frequency",
       fill = "Pollutant") +
  theme_minimal()
```

