---
title: "SDI Exploratoration"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: yeti
    code_folding: hide
css: styles.css
---

# SDI Exploratory anlyses

We sough to gather data from the Social deprivation index (SDI) is an effort in generating composite measures of socioeconomic factors across NYC by census tract. We will use these datasets to explore CitiBike availability and usage patterns across neighborhoods.

The data was found on the [SDI](https://www.graham-center.org/maps-data-tools/social-deprivation-index.html) website. From there we downloaded the `rgcsdi-2015-2019-zcta.csv` file and imported it as below.

```{r, include = FALSE}
library(tidyverse)
library(here)
```

First we load in the datasets necessary.

```{r, eval = TRUE}
SDI_df <- read_csv(here("data/SDI_data/rgcsdi-2015-2019-zcta.csv")) |>
  janitor::clean_names() |>
  select(zcta5_fips, sdi_score)|>
  rename(zip=zcta5_fips)

joined_uhf_34_42 = read_csv(here("data/geocoding/joined_uhf_34_42.csv"))
```


## Join SDI data to UHF/Zip/Neighborhood data
```{r, eval = TRUE}
joined_SDI_zip_neighborhood = 
  SDI_df |> 
  filter(zip %in% pull(joined_uhf_34_42, zip)) |> 
  mutate(zip = as.numeric(zip)) |> 
  left_join(y = joined_uhf_34_42, by = "zip")
```

# Exploratory Analyses

We then joined the UFH data to map neighborhoods on to zip codes. 
```{r, eval = TRUE}
joined_SDI_zip_neighborhood = 
  SDI_df |> 
  filter(zip %in% pull(joined_uhf_34_42, zip)) |> 
  mutate(zip = as.numeric(zip)) |> 
  left_join(y = joined_uhf_34_42, by = "zip")

knitr::kable(head(joined_SDI_zip_neighborhood[,1:5]))

#write output for ease of use in other files
#write_csv(joined_SDI_zip_neighborhood, here("data/SDI_data/SD_Zip_ufh.csv"))
```

This output variables: `zip, sdi_score, uhf42, uhf42_neighborhood, uhf34, uhf34_neighborhood`.

```{r  fig.width=7, fig.height=4}
joined_SDI_zip_neighborhood %>% 
  group_by(zip) %>%
  summarize(mean_SDI = mean(sdi_score)) %>%
  ggplot(aes(x = reorder(zip, -mean_SDI), y = mean_SDI)) +
  geom_histogram(stat = "identity") + 
  labs(
    title = "SDI score by Zip code",
    x = "Zip code",
    y = "SDI score"
  ) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

* Running an initial analysis by SDI score for zip code we can see a large range from 10% up to 100%


We then evaluate the SDI scores by neighborhoods (based on both the uhf34 and uhf42 registrations).


```{r fig.width=7, fig.height=4}
joined_SDI_zip_neighborhood %>% 
  group_by(uhf34_neighborhood) %>%
  summarize(mean_SDI = mean(sdi_score)) %>%
  ggplot(aes(x = reorder(uhf34_neighborhood, -mean_SDI), y = mean_SDI)) +
  geom_bar(stat = "identity") + 
  labs(
    title = "Mean SDI score by Neighborhood",
    x = "Neighborhood",
    y = "Mean SDI score"
  ) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

* Again we can see a max SDI score up to 100% (in East Harlem and South Bronx), with the lowest score in Souther St. 

* Two neighborhoods, Chealsea Village and Flushing Clearview, lacked SDI scores. 

```{r  fig.width=7, fig.height=4}
joined_SDI_zip_neighborhood %>% 
  group_by(uhf42_neighborhood) %>%
  summarize(mean_SDI = mean(sdi_score)) %>%
  ggplot(aes(x = reorder(uhf42_neighborhood, -mean_SDI), y = mean_SDI)) +
  geom_bar(stat = "identity") + 
  labs(
    title = "Mean SDI score by Neighborhood",
    x = "Neighborhood",
    y = "Mean SDI score"
  ) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

* Looking at the data by the uhf42 classifications again the peak scores are 100% in Crotona Tremont, East Harlem, and High Bridge Morrisania; lowest values in South Beach Tottenville. 

* Again Chealsea Village and Flushing Clearview were missing values.
