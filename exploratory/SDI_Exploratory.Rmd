---
title: "<span style='color: blue;'>Social Deprivation Index</span>"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: yeti
    code_folding: hide
css: styles.css
---
<style>
  h1 {
     font-weight: bold;
  }
</style>

------------------------------------------------------------------------

[The social deprivation index (SDI)](https://www.graham-center.org/maps-data-tools/social-deprivation-index.html) is an effort to generate a scoring system of socioeconomic factors using US census data from the American Community Survey. The final SDI is a composite measure of percent living in poverty, percent with less than 12 years of education, percent single-parent households, the percentage living in rented housing units, the percentage living in the overcrowded housing unit, percent of households without a car, and percentage nonemployed adults under 65 years of age. For more details please see the webpage link.

```{r, include = FALSE}
library(tidyverse)
library(here)
library(viridis)

knitr::opts_chunk$set(message = FALSE,
	echo = TRUE,
	warning = FALSE)
```

```{r load_data, include = FALSE}
citibike_df = read_csv("../citibike_clean/citibike_clean.csv")
```

  &nbsp;
  
In this webpage we will explore the SDI variable by start location and determine which summary statistic to use to coalece by neighborhood.

 &nbsp;
  
Below is a table of summary statistics for SDI. 
```{r }
citibike_df |>
  summarise(
    mean_sdi = round(mean(start_sdi_score, na.rm = TRUE), 1),
    sd_sdi = round(sd(start_sdi_score, na.rm = TRUE), 1),
    median_sdi = round(median(start_sdi_score, na.rm = TRUE), 1),
    q1_sdi = round(quantile(start_sdi_score, 0.25, na.rm = TRUE), 1),
    q3_sdi = round(quantile(start_sdi_score, 0.75, na.rm = TRUE), 1),
    iqr_sdi = round(IQR(start_sdi_score, na.rm = TRUE), 1),
    max_sdi = round(max(start_sdi_score, na.rm = TRUE), 1),
    min_sdi = round(min(start_sdi_score, na.rm = TRUE), 1)
  )|>
  pivot_longer(
    cols = c("mean_sdi", "sd_sdi", "median_sdi", "q1_sdi", "q3_sdi", "iqr_sdi", "max_sdi", "min_sdi"),
    names_to = "Statistic",
    values_to = "Value"
  )|>
  knitr::kable()
```

There is a wide range of SDI scores by start station location from `r citibike_df |> summarise(min_sdi = min(start_sdi_score, na.rm = TRUE)) %>% pull(min_sdi)` in zipdcode `r citibike_df %>% filter(start_sdi_score == min(start_sdi_score, na.rm = TRUE)) %>% select(start_zipcode)|>  distinct()|> pull()` which is in the neighborhood `r citibike_df %>% filter(start_sdi_score == min(start_sdi_score, na.rm = TRUE)) %>% select(start_uhf34_neighborhood)|>  distinct()|> pull()` and the borough `r citibike_df %>% filter(start_sdi_score == min(start_sdi_score, na.rm = TRUE)) %>% select(start_borough)|>  distinct()|> pull()` to  `r citibike_df |> summarise(max_sdi = max(start_sdi_score, na.rm = TRUE)) %>% pull(max_sdi)` in zipdcodes `r citibike_df %>% filter(start_sdi_score == max(start_sdi_score, na.rm = TRUE)) %>% select(start_zipcode)|>  distinct()|> pull()` which are in neighborhoods `r citibike_df %>% filter(start_sdi_score == max(start_sdi_score, na.rm = TRUE)) %>% select(start_uhf34_neighborhood)|>  distinct()|> pull()` and boroughs `r citibike_df %>% filter(start_sdi_score == max(start_sdi_score, na.rm = TRUE)) %>% select(start_borough)|>  distinct()|> pull()`.

  &nbsp;

Below are tables showing the top 5 highest SDI scores and lowest SDI scores by location.


```{r highest}
citibike_df |>
  arrange(desc(start_sdi_score)) |>
  select(start_zipcode, start_uhf34_neighborhood, start_borough, start_sdi_score)|>
  distinct() |>
  head(5) |>
  knitr::kable()
```

```{r lowest}
citibike_df |>
  arrange(start_sdi_score) |>
  select(start_zipcode, start_uhf34_neighborhood, start_borough, start_sdi_score)|>
  distinct() |>
  head(5)|>
  knitr::kable()
```

  &nbsp;

Since SDI score is on the zipcode level, we next decide if mean or median is the better way to iterate across neighborhoods.

```{r mean vs median by neighborhood}
citibike_df |>
  group_by(start_uhf34_neighborhood) |>
  summarise(
    mean_sdi = mean(start_sdi_score, na.rm = TRUE),
    median_sdi = median(start_sdi_score, na.rm = TRUE),
     max_sdi = round(max(start_sdi_score, na.rm = TRUE), 1),
    min_sdi = round(min(start_sdi_score, na.rm = TRUE), 1)
  )|>
  knitr::kable()
```

Mean and median SDI scores are similar by start neighborhood. However median SDI scores tend to be lower and better capture the wide variation in score across neighborhood.

  &nbsp;
  
Will next evaluate median SDI score by start zip code.

```{r fig.width=7, fig.height=4}
citibike_df %>% 
  group_by(start_zipcode) %>%
  summarize(median_SDI = median(start_sdi_score)) %>%
  ggplot(aes(x = reorder(start_zipcode, -median_SDI), y = median_SDI)) +
  geom_histogram(stat = "identity") + 
  labs(
    title = "SDI score by Zip code",
    x = "Zip code",
    y = "SDI score"
  ) + 
   scale_fill_viridis(discrete = TRUE) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
 
```

It is difficult to discern the variation in start zip codes, but we can see there is a wide range.

  &nbsp;

Next will look at median SDI by start neighborhood.

```{r  fig.width=7, fig.height=4}
citibike_df |>
  group_by(start_uhf34_neighborhood) |>
  summarize(median_SDI = median(start_sdi_score)) |>
  ggplot(aes(x = reorder(start_uhf34_neighborhood, -median_SDI), y = median_SDI)) +
  geom_bar(stat = "identity") + 
  labs(
    x = "Neighborhood",
    y = "Median SDI score"
  ) + 
  scale_fill_viridis(discrete = TRUE) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
